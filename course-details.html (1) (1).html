<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GDB – Course details</title>
  <style>
    :root{--bg:#0b1713;--fg:#f5f5f5;--card:rgba(255,255,255,.05);--bd:rgba(255,255,255,.12);--accent:#6ee7b7}
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--fg)}
    a{color:inherit}
    header{position:sticky;top:0;z-index:50;background:rgba(11,23,19,.78);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.10)}
    .header-inner{max-width:1100px;margin:0 auto;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:18px}
    .brand{display:flex;align-items:center;gap:12px;text-decoration:none}
    .brand svg{width:118px;height:auto;display:block}
    .btn{
      padding:10px 12px;border-radius:12px;background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.20);cursor:pointer;font-weight:900;color:#fff;text-decoration:none;
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
    }
    .btn:hover{background:rgba(255,255,255,.10)}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;align-items:start}
    @media (max-width:920px){.grid{grid-template-columns:1fr}}
    .hero{
      background:var(--card);border:1px solid var(--bd);border-radius:18px;overflow:hidden;
      box-shadow:0 18px 60px rgba(0,0,0,.35)
    }
    .hero-img{width:100%;height:320px;object-fit:cover;display:block;background:linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.02))}
    .hero-body{padding:16px}
    .kicker{font-size:13px;opacity:.78;font-weight:900;letter-spacing:.4px}
    h1{margin:6px 0 8px;font-size:30px;line-height:1.12}
    .sub{opacity:.8;margin:0 0 12px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{
      border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.05);
      padding:7px 10px;border-radius:999px;font-size:12px;font-weight:900;opacity:.95;
    }

    .card{background:var(--card);border:1px solid var(--bd);border-radius:18px;padding:14px}
    .card h2{margin:0 0 10px;font-size:16px}
    .rows{display:grid;gap:10px}
    .row{display:grid;grid-template-columns:140px 1fr;gap:10px;align-items:start}
    .label{font-size:11px;letter-spacing:.6px;text-transform:uppercase;opacity:.65;margin-top:2px}
    .value{font-size:14px;font-weight:900;opacity:.95;word-break:break-word}
    .value.muted{opacity:.78;font-weight:800}

    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .actions .btn{flex:1 1 180px}

    .section{margin-top:16px}
    .section h2{margin:0 0 10px;font-size:16px}
    .desc{line-height:1.65;opacity:.92}
    .two-col{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:720px){.two-col{grid-template-columns:1fr}}
    ul{margin:0;padding-left:18px;line-height:1.6}
    .note{font-size:13px;opacity:.72;line-height:1.5}
    .divider{height:1px;background:rgba(255,255,255,.10);margin:14px 0}
  </style>
</head>
<body>
<header>
  <div class="header-inner">
    <a class="brand" href="search-courses.html" aria-label="Back to search">
      <svg aria-label="GDB logo" role="img" viewBox="0 0 420 120">
        <text x="210" y="70" text-anchor="middle" font-family="Libre Baskerville, Georgia, serif" font-size="72" font-weight="700" letter-spacing="-1.5" fill="#ffffff">GDB</text>
        <text x="210" y="104" text-anchor="middle" font-family="Libre Baskerville, Georgia, serif" font-size="18" letter-spacing="1.6" fill="#ffffff" opacity="0.9">Golf Done Better</text>
      </svg>
    </a>
    <a class="btn" href="search-courses.html">Back to search</a>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <section class="hero" aria-label="Course overview">
      <img class="hero-img" id="heroImg" alt="Course image" />
      <div class="hero-body">
        <div class="kicker" id="kicker">Course</div>
        <h1 id="name">Loading</h1>
        <p class="sub" id="place"> </p>

        <div class="actions" id="actions">
          <a class="btn" id="openMaps" target="_blank" rel="noopener">Open in Maps</a>
          <a class="btn" id="openWebsite" target="_blank" rel="noopener" style="display:none">Official website</a>
          <a class="btn" id="openWiki" target="_blank" rel="noopener" style="display:none">Wikipedia</a>
        </div>

        <div class="chips" id="chips"></div>
      </div>
    </section>

    <aside class="card" aria-label="Key details">
      <h2>Key details</h2>
      <div class="rows" id="keyRows"></div>
      <div class="divider"></div>
      <div class="note" id="dataNote">
        Data is pulled from OpenStreetMap plus Wikipedia and Wikidata enrichment where available.
        This page does not scrape official course websites because browser security blocks most cross site requests without a backend proxy.
      </div>
    </aside>
  </div>

  <section class="section card" aria-label="Description">
    <h2>Description and notes</h2>
    <div class="desc" id="description">Loading</div>
  </section>

  <div class="two-col section">
    <section class="card" aria-label="Facilities">
      <h2>Facilities</h2>
      <div id="facilities"> </div>
    </section>
    <section class="card" aria-label="More information">
      <h2>More information</h2>
      <div id="moreInfo"> </div>
    </section>
  </div>
</main>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const PLACEHOLDER_IMG = 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`<?xml version="1.0" encoding="UTF-8"?>\n<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="600" viewBox="0 0 1200 600">\n  <defs>\n    <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">\n      <stop offset="0" stop-color="#153126" />\n      <stop offset="1" stop-color="#0b1713" />\n    </linearGradient>\n  </defs>\n  <rect width="1200" height="600" fill="url(#g)"/>\n  <g fill="#ffffff" opacity="0.80" font-family="Arial, Helvetica, sans-serif" font-weight="900">\n    <text x="50%" y="50%" font-size="30" text-anchor="middle">Golf Done Better</text>\n    <text x="50%" y="60%" font-size="15" text-anchor="middle" opacity="0.75">No image available</text>\n  </g>\n</svg>`);

  const q = new URLSearchParams(location.search);
  const id = q.get('id') || '';

  const safeText = (s) => String(s || '').trim();
  const titleCase = (x) => {
    const s = safeText(x).replace(/_/g,' ');
    if(!s) return '';
    return s.split(' ').filter(Boolean).map(w => w.slice(0,1).toUpperCase() + w.slice(1)).join(' ');
  };
  const labels = (arr) => (arr || []).map(x => x === 'hiddenGem' ? 'Hidden gem' : titleCase(x));

  const priceLabel = (c) => {
    const lo = Number(c.priceLow || 0);
    const hi = Number(c.priceHigh || 0);
    if(!lo && !hi) return 'Price unknown';
    if(lo && hi && lo !== hi) return `£${lo} to £${hi}`;
    return `£${lo || hi}`;
  };

  const openMapsHref = (lat, lng, name) => {
    if(!Number.isFinite(lat) || !Number.isFinite(lng)) return '#';
    const q = encodeURIComponent((name ? name + ' ' : '') + lat + ',' + lng);
    return 'https://www.google.com/maps/search/?api=1&query=' + q;
  };

  const parseEmail = (tags) => safeText(tags && (tags.email || tags['contact:email'] || tags['email:booking']));
  const parsePhone = (tags) => safeText(tags && (tags.phone || tags['contact:phone'] || tags['phone:booking']));
  const parseWebsite = (tags) => safeText(tags && (tags.website || tags['contact:website'] || tags.url));
  const parseAddress = (tags) => {
    if(!tags) return '';
    const parts = [
      tags['addr:housenumber'],
      tags['addr:street'],
      tags['addr:city'],
      tags['addr:postcode'],
      tags['addr:country']
    ].map(safeText).filter(Boolean);
    return parts.join(', ');
  };

  const getSavedList = () => {
    try { return JSON.parse(localStorage.getItem('gdb_last_results') || '[]'); }
    catch(e){ return []; }
  };

  const render = async () => {
    if(!id){
      $('name').textContent = 'Course not found';
      $('place').textContent = 'This page needs a course id.';
      $('heroImg').src = PLACEHOLDER_IMG;
      $('description').textContent = 'Return to the search page and open Full Details from a result.';
      $('keyRows').innerHTML = '';
      $('facilities').innerHTML = '<div class="note">No data</div>';
      $('moreInfo').innerHTML = '<div class="note">No data</div>';
      return;
    }

    const list = getSavedList();
    const c = list.find(x => String(x && x.id) === String(id)) || null;

    if(!c){
      $('name').textContent = 'Course not found';
      $('place').textContent = 'Open Full Details from the search page again so this page can read the latest results.';
      $('heroImg').src = PLACEHOLDER_IMG;
      $('description').textContent = 'No cached course data was found in this browser.';
      $('keyRows').innerHTML = '';
      $('facilities').innerHTML = '<div class="note">No data</div>';
      $('moreInfo').innerHTML = '<div class="note">No data</div>';
      return;
    }

    $('name').textContent = safeText(c.name) || 'Golf';
    $('place').textContent = safeText(c.place) || ' ';
    $('kicker').textContent = c.kind === 'range' ? 'Driving range' : 'Course';

    // Image
    const img = safeText(c.imageUrl || '');
    $('heroImg').src = img || PLACEHOLDER_IMG;
    $('heroImg').onerror = () => { $('heroImg').src = PLACEHOLDER_IMG; };

    // Actions
    $('openMaps').href = openMapsHref(Number(c.lat), Number(c.lng), safeText(c.name));
    const website = parseWebsite(c.tags || {});
    if(website && /^https?:\/\//i.test(website)){
      $('openWebsite').href = website;
      $('openWebsite').style.display = 'inline-flex';
    }
    const wikipedia = safeText(c.tags && c.tags.wikipedia);
    if(wikipedia){
      const parts = wikipedia.split(':');
      const lang = parts.shift() || 'en';
      const title = parts.join(':');
      if(title){
        $('openWiki').href = 'https://' + lang + '.wikipedia.org/wiki/' + encodeURIComponent(title.replace(/ /g,'_'));
        $('openWiki').style.display = 'inline-flex';
      }
    }

    // Chips
    const chipList = [];
    if(c.holes) chipList.push(String(c.holes) + ' holes');
    if(c.par) chipList.push('Par ' + c.par);
    if(c.style && c.style !== 'unspecified') chipList.push(titleCase(c.style));
    if(c.access) chipList.push(c.access === 'public' ? 'Public' : c.access === 'visitor' ? 'Visitor access' : c.access === 'members' ? 'Members' : titleCase(c.access));
    if(Array.isArray(c.vibe) && c.vibe.length) chipList.push(...labels(c.vibe).slice(0,3));
    $('chips').innerHTML = chipList.map(x => '<span class="chip">' + x + '</span>').join('');

    // Key rows
    const address = parseAddress(c.tags || {});
    const email = parseEmail(c.tags || {});
    const phone = parsePhone(c.tags || {});
    const rows = [
      ['Holes', c.holes ? String(c.holes) : 'Unknown'],
      ['Par', c.par ? String(c.par) : 'Unknown'],
      ['Length', c.lengthM ? (Math.round(Number(c.lengthM)/10)*10 + ' m') : 'Unknown'],
      ['Est price', priceLabel(c)],
      ['Address', address || 'Not listed'],
      ['Phone', phone || 'Not listed'],
      ['Email', email || 'Not listed'],
      ['Website', website || 'Not listed']
    ];
    $('keyRows').innerHTML = rows.map(([k,v]) => {
      const val = safeText(v) || ' ';
      const isLink = /^https?:\/\//i.test(val);
      const html = isLink ? '<a href="' + val + '" target="_blank" rel="noopener">' + val + '</a>' : val;
      return '<div class="row"><div class="label">' + k + '</div><div class="value' + (val === 'Not listed' ? ' muted' : '') + '">' + html + '</div></div>';
    }).join('');

    // Description
    const desc = safeText(c.summary || c.description || (c.tags && (c.tags.description || c.tags['description:en'])) || '');
    $('description').textContent = desc || 'No description available yet.';

    // Facilities
    const fac = labels(c.facilities || []);
    $('facilities').innerHTML = fac.length ? ('<ul>' + fac.map(x => '<li>' + x + '</li>').join('') + '</ul>') : '<div class="note">No facilities were listed.</div>';

    // More info
    const more = [];
    const diff = labels(c.difficulty || []);
    const walk = labels(c.walkability || []);
    if(diff.length) more.push(['Difficulty', diff.join(', ')]);
    if(walk.length) more.push(['Walkability', walk.join(', ')]);
    if(c.accommodation) more.push(['Accommodation', titleCase(c.accommodation)]);
    if(c.access) more.push(['Access', c.access === 'public' ? 'Public' : c.access === 'visitor' ? 'Visitor access' : c.access === 'members' ? 'Members' : titleCase(c.access)]);
    if(Number.isFinite(Number(c.lat)) && Number.isFinite(Number(c.lng))) more.push(['Coordinates', Number(c.lat).toFixed(5) + ', ' + Number(c.lng).toFixed(5)]);
    if(c.tags && c.tags.wikidata) more.push(['Wikidata', safeText(c.tags.wikidata)]);
    $('moreInfo').innerHTML = more.length
      ? ('<div class="rows">' + more.map(([k,v]) => '<div class="row"><div class="label">' + k + '</div><div class="value">' + safeText(v) + '</div></div>').join('') + '</div>')
      : '<div class="note">No additional fields were found.</div>';
  };

  // The search page can store the most recent result set here for details pages.
  // If it does not exist yet, the page still loads with a helpful message.
  render();
})();
</script>
</body>
</html>
